<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.metamong.mt.member.repository.mybatis.IMemberRepository">

    <!-- 회원 조회 -->
	<select id="selectLoginMember" parameterType="com.metamong.mt.member.dto.request.LoginRequestDto" resultType="com.metamong.mt.member.model.Member">
	<![CDATA[
SELECT user_id, name, password, phone, email, role 
FROM member 
WHERE user_id = #{userId}

	]]>
	</select>	
	
	<!-- 회원 가입 -->
	<insert id="insertMember" parameterType="com.metamong.mt.member.model.Member">
	<![CDATA[
		INSERT INTO 
			member (user_id, name, password, phone, email, birth, postal_code, address,detail_address,business_name, business_registration_number,role ) 
		VALUES 
			(#{userid}, #{name}, #{password}, #{phone}, #{email},#{birth, jdbcType=DATE},#{postal_code,jdbcType=VARCHAR},#{address,jdbcType=VARCHAR},#{detail_address,jdbcType=VARCHAR} , #{businessName, jdbcType=VARCHAR}, #{businessRegistrationNumber,jdbcType=VARCHAR},#{role})
	]]>
	</insert>
	

	<!-- Refresh Token 업데이트 -->
	<update id="updateMember" parameterType="com.metamong.mt.member.model.Member">
	<![CDATA[
		UPDATE member
		SET refresh_token = #{refreshToken}
		WHERE user_id = #{userid}
	]]>
	</update>
	    <!-- 관리자 계정 존재 여부 확인 -->
    <select id="existsAdmin" resultType="boolean">
    <![CDATA[
        SELECT COUNT(*) 
        FROM member 
        WHERE user_id = 'admin'
    ]]>
    </select>
    
<select id="selectMember" resultType="com.metamong.mt.member.dto.response.LoginResponseDto">
  SELECT user_id AS userId,
         name,
         phone,
         email,
         role
  FROM member
  WHERE user_id = #{userId}
</select>

<select id="selectMemberEntity" resultType="com.metamong.mt.member.model.Member">
SELECT user_id AS userid,
           name,
           password,
           phone,
           email,
           birth,
           postal_code,
           detail_address,
           address,
           role,
           refresh_token AS refreshToken,
           business_name AS businessName,
           business_registration_number AS businessRegistrationNumber
    FROM member
    WHERE user_id = #{userId}
</select>

</mapper>
